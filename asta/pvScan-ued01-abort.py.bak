#!/usr/bin/env python
# For aborting scans.  
# mdunning 1/7/16

from epics import caget,caput,PV,Motor
from time import sleep
import datetime,math,os,sys,signal
from threading import Thread

pidPV=PV('ASTA:PV01:PID')
pid=pidPV.get()
msgpv=PV('ASTA:PV01:MSG')

# Motor PVs
motor1='ASTA:XPSxx:m4'
# Motor stop PVs
motor1Stop=PV(motor1 + ':MOTR.STOP')

# Shutters
laserShutter1ClosePv=PV('ASTA:LSC01:OC:CLOSE')
laserShutter2ClosePv=PV('ASTA:LSC02:OC:CLOSE')
laserShutter3ClosePv=PV('ASTA:LSC03:OC:CLOSE')


##################################################################################################################            
    
def abortRoutine():
    "This is the abort routine"
    msgpv.put('Aborting')
    # kill scan routine process
    os.kill(pid, signal.SIGKILL)
    # block laser(s)
    laserShutter1ClosePv.put(1)
    laserShutter2ClosePv.put(1)
    laserShutter3ClosePv.put(1)
    # stop motors
    motor1Stop.put(1)
    msgpv.put('Aborted')

    
    

if __name__ == "__main__":
    "Do abort routine"
    # Uncomment the following line to enable 
    #abortRoutine()

        
##################################################################################################################
        

exit

